[% WRAPPER wrapper.tt title = 'ayano' %]
<script type="text/javascript" id="js">
	$(function() {
		
		$('#try').click(function(e) {
			$("#sign_up").lightbox_me({centered: true, preventScroll: true, onLoad: function() {
				$("#sign_up").find("input:first").focus();
			}});
			
			e.preventDefault();
		});
	
		$('table tr:nth-child(even)').addClass('stripe');
	});
</script>
<script type="text/javascript">
	function onload() {
	}
</script>

<div style="padding: 3px;">
  <form method="post" action="[% c.uri_for(c.action, { code => goods.code }) %]" name="forgoods" id="forgoods">
	<input type="hidden" name="update" value="[% update %]">
	<table border="0" cellpadding="3" cellspacing="0" align="center">
	  <tr>
		<td>店　舗 [% must %]: </td>
		<td>
		  <select name="goods.store_code" class="fcs" style="width: 120px;">
			[%- IF update %]
			<option name="[% goods.store_code %]" value="[% goods.store_code %]" selected>[% goods.store_code _ ' : ' _ store.name %]</option>
			[%- ELSE %]
			[%- FOREACH e = c.session.writing.store %]
			<option name="[% e.code %]" value="[% e.code %]" [% IF e.code == goods.store_code %]selected[% END %]>[% e.code _ ' : ' _ e.name %]</option>
			[%- END %]
			[%- END %]
		  </select>
		</td>
	  </tr>
	  <tr>
		<td>品　番 [% must %]: </td>
		<td>
		  <input type="text" name="goods.code" class="fcs" maxlength="8" style="ime-mode: disabled; width: 120px;" value="[% goods.code | html %]" readonly>
		  <span style="color: #555;">商品コードは自動で採番されます。</span>
		</td>
	  </tr>
	  <tr>
		<td>部門/分類: </td>
		<td>
		  <select name="goods.category_code" class="fcs" style="width: 200px;">
			[%- FOREACH e = dropdown.category %]
			<option value="[% e.code %]" [% IF e.code == goods.category_code %]selected[% END %]>[% e.code _ ' : ' _ e.name %]</option>
			[%- END %]
		  </select>
		  <select name="goods.class_code" style="class="fcs" width: 300px;">
			<option value=""></option>
			[%- FOREACH e = dropdown.class %]
			<option value="[% e.code %]" [% IF e.code == goods.class_code %]selected[% END %]>[% e.code _ ' : ' _ e.l_name _'/' _ e.m_name _ '/' _ e.s_name %]</option>
			[%- END %]
		  </select>
		</td>
	  </tr>
	  <tr>
		<td>品　名 [% must %]: </td>
		<td>
		  <input type="text" name="goods.name" class="fcs" value="[% goods.name || goods_name | html %]" style="width: 410px;" autofocus>
		</td>
	  </tr>
	  <tr>
		<td>カタカナ: </td>
		<td>
		  <input type="text" name="goods.katakana" class="fcs" value="[% goods.katakana | html %]" style="width: 410px;" autofocus>
		  単位: 
		  <input type="text" name="goods.unit" class="fcs" value="[% goods.unit | html %]" style="width: 50px;">
		</td>
	  </tr>
	  <tr>
		<td>仕様/規格: </td>
		<td>
		  <input type="text" name="goods.spec" class="fcs" value="[% goods.spec | html %]" style="width:500px;">
		</td>
	  </tr>
	  <tr>
		<td>メーカー: </td>
		<td>
		  <input type="text" name="goods.maker" class="fcs" value-="[% goods.maker | html %]" style="width:500px;">
		</td>
	  </tr>
	  <tr>
		<td>仕入先　: </td>
		<td>
		  <input type="text" name="goods.supplier_code" id="goods.supplier_code" class="fcs" value="[% goods.supplier_code | html %]" style="width: 120px;" onChange="get_supplier()">
		  <input type="text" name="supplier_name" id="supplier_name" class="fcs" value="[% supplier.name | html %]" style="width: 375px;" readonly>
		</td>
	  </tr>
	  <tr>
		<td>単　価　: </td>
		<td>
		  売り: 
		  <input type="text" class="right float fcs" style="width:100px; ime-mode:disabled;" name="goods.unitprice" id="goods.unitprice" value="[% goods.unitprice | format('%.2f') %]">
		  仕入: 
		  <input type="text" class="right float fcs" style="width:100px; ime-mode:disabled;" name="goods.unitcost" id="goods.unitcost" value="[% goods.unitcost | format('%.2f') %]" onChange="set_profit()" onKeyup="set_profit()">
		  粗利: 
		  <input type="text" class="right" style="width:100px;" name="profit" id="profit" value="[% profit | format('%.2f') %]" tabindex="-1" readonly>
		  <input type="text" class="right" style="width:80px;" name="profit_rate" id="profit_rate" value="[% profit_rate | format('%.2f') %]" tabindex="-1" readonly>
		</td>
	  </tr>
	  <tr>
		<td>備考: </td>
		<td>
		  <textarea name="goods.note" id="goods.note" class="fcs" rows="2" style="width:100%;">[% goods.note | html %]</textarea>
		</td>
	  </tr>
	  <tr>
		<td valign="top">有効/無効: </td>
		<td>
		  <select style="width:120px" name="goods.deleted" class="fcs">
			[%- FOREACH del = dropdown.deleted %]
			<option value="[% del.code %]" [% IF del.code == goods.deleted %]selected[% END %]>[% del.name %]</option>
			[%- END %]
		  </select>
		</td>
	  </tr>
	  <tr>
		<td colspan="2">
		  <div style="padding: 5px; text-align:right;">
			<input type="hidden" name="goods.created_by" value="[% goods.created_by || user %]">
			<input type="hidden" name="goods.updated_by" value="[% user %]">

			<input type="hidden" id="type" name="type" value="">
			<button type="button" name="commit" class="blue fcs" onclick="$('#type').val(this.name);submit();">登録</button>
			<button type="button" name="new" class="fcs" onClick="location.href='[% c.uri_for(c.action) %]'">新規</button>
		  </div>
		</td>
	  </tr>
	  <tr>
		<td colspan="2">
		  <table style="float:right;">
			<tbody style="color:#555;">
			  <tr>
				<td>登録: </td>
				<td>[% goods.created_on || "******" %]</td>
				<td>[% goods.created_by || "******" %]</td>
			  </tr>
			  <tr>
				<td>更新: </td>
				<td>[% goods.updated_on || "******" %]</td>
				<td>[% goods.updated_by || "******" %]</td>
			  </tr>
			</tbody>
		  </table>
		</td>
	  </tr>
	  <tr>
		<td colspan="2">
		  [% form = c.flash.error %]
		  [% IF form.has_error %]
		  [% FOREACH message IN form.messages(c.action.reverse) %]
		  <div>[% message %]</div>
		  [% END %]
		  [% ELSIF overlap_error %]
		  <font color="#ff0000">[% overlap_error %]</font>
		  [% ELSE %]
		  <font color="#0000ff">[% message %]</font>
		  [% END %]
		</td>
	  </tr>
	</table>
  </form>
</div>
<hr style="height: 1px; border: none; border-top: 1px #aaa dashed;">

<div style="padding: 3px; width: 60%; margin-left:auto;margin-right:auto;">
  <h3>この商品の価格履歴(過去○年)</h3>
  <table class="sort" id="trendlist">
	<thead class="header">
	  <tr>
		<th>履歴No.</th>
		<th>適用年月</th>
		<th>金額</th>
		<th>見積番号</th>
		<th>仕入先</th>
		<th>担当者</th>
	  </tr>
	</thead>
	<tbody>
	  [%- FOREACH a = history %]
	  <tr>
		<td class="center"><a href="[% c.uri_for('/history/edit', { code => a.history.code }) %]">[% a.history.code %]</a></td>
		<td class="right">[% a.date %]</td>
		<td class="right">[% a.price %]</td>
		<!--	  <td class="center"><a href="[% c.uri_for('/estimate/edit', { code => a.estimate.code }) %]">[% a.estimate.code %]</a></td> -->
		<td class="center"><a href="#" id="try">[% a %]</a></td>
		<td class="right">[% a.supplier %]</td>
		<td class="center">[% a.updated_by || created_by %]</td>
	  </tr>
	  [%- END %]
	</tbody>
  </table>
</div>


<div id="sign_up" style="display: none; background: #ffffff; padding: 22px; -webkit-border-radius: 6px">
  <form method="post" action="[% c.uri_for(c.action, { code => history.code }) %]">
	<input type="hidden" name="update" value="[% update %]">
	<table border="0" cellpadding="3" cellspacing="0" align="center">
	  <tr>
		<td>見積番号 : </td>
		<td>
		  <input type="text" name="goods.code" class="fcs" maxlength="8" style="ime-mode: disabled; width: 120px;" value="[% goods.code | html %]" readonly>
		</td>
	  </tr>
	  <tr>
		<td>仕入先　: </td>
		<td>
		  <input type="text" name="goods.supplier_code" id="goods.supplier_code" class="fcs" value="[% goods.supplier_code | html %]" style="width: 120px;" onChange="get_supplier()">
		  <input type="text" name="supplier_name" id="supplier_name" class="fcs" value="[% supplier.name | html %]" style="width: 375px;" readonly>
		</td>
	  </tr>
	  <tr>
		<td>単　価　: </td>
		<td>
		  売り: 
		  <input type="text" class="right float fcs" style="width:100px; ime-mode:disabled;" name="goods.unitprice" id="goods.unitprice" value="[% goods.unitprice | format('%.2f') %]">
		  仕入: 
		  <input type="text" class="right float fcs" style="width:100px; ime-mode:disabled;" name="goods.unitcost" id="goods.unitcost" value="[% goods.unitcost | format('%.2f') %]" onChange="set_profit()" onKeyup="set_profit()">
		  粗利: 
		  <input type="text" class="right" style="width:100px;" name="profit" id="profit" value="[% profit | format('%.2f') %]" tabindex="-1" readonly>
		  <input type="text" class="right" style="width:80px;" name="profit_rate" id="profit_rate" value="[% profit_rate | format('%.2f') %]" tabindex="-1" readonly>
		</td>
	  </tr>
	  <tr>
		<td>備考: </td>
		<td>
		  <textarea name="goods.note" id="goods.note" class="fcs" rows="2" style="width:100%;">[% goods.note | html %]</textarea>
		</td>
	  </tr>
	  <tr>
		<td valign="top">有効/無効: </td>
		<td>
		  <select style="width:120px" name="goods.deleted" class="fcs">
			[%- FOREACH del = dropdown.deleted %]
			<option value="[% del.code %]" [% IF del.code == goods.deleted %]selected[% END %]>[% del.name %]</option>
			[%- END %]
		  </select>
		</td>
	  </tr>
	  <tr>
		<td colspan="2">
		  <div style="padding: 5px; text-align:right;">
		  <input type="hidden" name="goods.created_by" value="[% goods.created_by || user %]">
		  <input type="hidden" name="goods.updated_by" value="[% user %]">

			<input type="hidden" id="type" name="type" value="">
			<button type="button" name="commit" class="blue fcs" onclick="$('#type').val(this.name);submit();">登録</button>
			<button type="button" name="new" class="fcs" onClick="location.href='[% c.uri_for(c.action) %]'">新規</button>
		  </div>
		</td>
	  </tr>
	  <tr>
		<td colspan="2">
		  <table style="float:right;">
			<tbody style="color:#555;">
			  <tr>
				<td>登録: </td>
				<td>[% goods.created_on || "******" %]</td>
				<td>[% goods.created_by || "******" %]</td>
			  </tr>
			  <tr>
				<td>更新: </td>
				<td>[% goods.updated_on || "******" %]</td>
				<td>[% goods.updated_by || "******" %]</td>
			  </tr>
			</tbody>
		  </table>
		</td>
	  </tr>
	  <tr>
		<td colspan="2">
		  [% form = c.flash.error %]
		  [% IF form.has_error %]
		  [% FOREACH message IN form.messages(c.action.reverse) %]
		  <div>[% message %]</div>
		  [% END %]
		  [% ELSIF overlap_error %]
		  <font color="#ff0000">[% overlap_error %]</font>
		  [% ELSE %]
		  <font color="#0000ff">[% message %]</font>
		  [% END %]
		</td>
	  </tr>
	</table>
  </form>
</div>		  

[%- END %]
